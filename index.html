<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>GT project</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <link href="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    .flex-container {
      display: flex;
      height: 100vh;
      margin: 10px;
    }

    .coordinates-input {
      width: 30vw;
    }

    .coordinates-input input {
      width: 90%;
      margin: 10px;
    }

    #map {
      position: relative;
      top: 0;
      bottom: 0;
      width: 70%;
    }
  </style>
</head>

<body>
  <!-- Load the `mapbox-gl-geocoder` plugin. -->
  <script
    src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
  <link rel="stylesheet"
    href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">
  <div class="flex-container">
    <div class="coordinates-input">
      <form action="">
        <div class="mb-3">
          <label for="source" class="form-label">Source</label>
          <input type="text" class="form-control" id="source" onfocus="getFocusedElement()">
        </div>
        <div class="mb-3" id="destination">
          <label for="destination" class="form-label">Destination</label>
          <input type="text" class="form-control" id="dest1" onfocus="getFocusedElement()">
          <input type="text" class="form-control" id="dest2" onfocus="getFocusedElement()">
          <input type="text" class="form-control" id="dest3" onfocus="getFocusedElement()">
        </div>
        <div class="mb-3">
          <a href="#" onclick="newDestination()">+ Add destination</a>
        </div>
        <div class="mb-3">
          <button type="submit" class="btn btn-primary">Submit</button>
        </div>
      </form>
    </div>
    <div id="map" class="map-style"></div>
  </div>

  <!-- Option 1: Bootstrap Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>

  <!-- Option 2: Separate Popper and Bootstrap JS -->
  <!--
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
  -->
  <script>
    var focused_elem = null;
    function getFocusedElement() {
      focused_elem = document.activeElement.id;
      console.log(focused_elem);
    }

    function newDestination() {
      var parentDiv = document.getElementById("destination");
      var newInput = document.createElement("input");
      newInput.type = "text";
      newInput.className = "form-control";
      newInput.id = "dest" + (parentDiv.childElementCount + 1);
      newInput.onfocus = getFocusedElement;
      parentDiv.appendChild(newInput);
    }
  </script>
  <script>
    // TO MAKE THE MAP APPEAR YOU MUST
    // ADD YOUR ACCESS TOKEN FROM
    // https://account.mapbox.com
    mapboxgl.accessToken = 'pk.eyJ1Ijoic2t5Z3VwdGEzNDUiLCJhIjoiY2xmNDBuNWkxMHk0dTNvcjAzNWE4dDcxOCJ9.q1NkZ5kMRNjsXklpVFFk8Q';
    const map = new mapboxgl.Map({
      container: 'map', // container id
      // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
      style: 'mapbox://styles/mapbox/streets-v12',
      center: [-74.5, 40], // starting position
      zoom: 9 // starting zoom
    });

    // Add the control to the map.
    map.addControl(
      new MapboxGeocoder({
        accessToken: mapboxgl.accessToken,
        mapboxgl: mapboxgl
      })
    );

    var currentMarker = null;
    map.on('click', (e) => {
      if (focused_elem != null) {
        if (currentMarker !== null) {
          currentMarker.remove();
        }
        currentMarker = new mapboxgl.Marker()
          .setLngLat(e.lngLat)
          .addTo(map);
        document.getElementById(focused_elem).value =
          e.lngLat.lng + "," + e.lngLat.lat;
      }
    });
  </script>

</body>

</html>